---
title: MySQL二进制日志格式
categories:
  - 数据库
date: 2018-03-08 23:45:43
updated: 2018-03-08 23:45:43
tags: 
  - MySQL
---
我们都知道二进制日志是一个非常好的习惯和工具。其可以用来进行恢复数据到某一时间点，或重放整个数据的变更过程，但其实这里面还有不少学问。
# 简介
二进制日志包含的是描述数据库改变（比如表建立或表数据修改）的事件。在使用 **基于行** 的日志格式时也会包含可能会改变数据的事件（如 `DELETE`语句，但并无匹配行）。二进制日志也会记录每个语句更新数据所消耗的时间。二进制日志的设计，有两个重要的目标：

* 复制，二进制日志记录了在主服务器上数据变更记录，用来发送给从服务器。主服务器会把二进制日志中的事件发送给从服务器，然后在从服务器上再次执行。
* 一些数据恢复操作需要二进制日志。在一个备份恢复后，二进制日志中在此备份后的事件可以被重新执行。这能保证让数据库从备份时恢复到最新状态。

二进制日志并不会记录类似 `select, show`这些不会改变数据的语句。

开启二进制日志会使服务器性能轻微下降，但开启这个日志来设置从服务器和数据恢复的好处远远大过了性能的降低。

要保护好二进制日志，因为记录的语句中可能会含有密码。

# 二进制日志格式
二进制日志有几种格式。

* 基于语句的日志格式。选项 `--binlog-format=STATEMENT`
* 基于行的格式。主服务器将表示每个单独表行受影响的事件写入二进制日志。选项`--binlog-format=ROW`
* 混合格式。当设置这个选项`--bilong-format=MIXED`，默认会使用 基于行的格式，但在某些情况下会自动切换为基于语句的格式。

在MySQL5.5中，默认的二进制日志格式是 STATEMET。

日志格式可以被存储引擎设置或限制。这用来避免在使用不同存储引擎的主从服务器在执行特定语句时的问题。

在基于语句的复制中，**在复制非确定性的语句时可能会出现问题**。在确定一个语句使用基于语句的复制是否安全时，MySQL会确定能不能保证这个语句可以用基于语句的格式进行复制。如果不能保证，则会抛出警告。为了避免这个问题，可以采用基于行的复制。

